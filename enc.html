<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Encoder</title>
<style>
/* --- Windows 95 Colors & Fonts --- */
:root {
  --w95-bg: #c0c0c0;
  --w95-window: #fff;
  --w95-border-light: #fff;
  --w95-border-mid: #dfdfdf;
  --w95-border-dark: #808080;
  --w95-border-very-dark: #000;
  --w95-blue: #000080;
  --w95-btn-bg: #e0e0e0;
  --w95-btn-border: #808080;
  --w95-btn-border-light: #fff;
  --w95-btn-border-dark: #000;
  --w95-label: #000;
  --w95-input: #fff;
  --w95-input-border: #808080;
}
body {
  background: var(--w95-bg);
  min-height: 100vh;
  margin: 0;
  padding: 0;
  font-family: 'MS Sans Serif', 'Tahoma', Geneva, Verdana, sans-serif;
  display: flex;
  align-items: flex-start;
  justify-content: center;
}
.w95-window {
  margin: 42px 0;
  padding: 0;
  background: var(--w95-window);
  border-style: solid;
  border-width: 2px;
  border-color: var(--w95-border-light) var(--w95-border-dark) var(--w95-border-dark) var(--w95-border-light);
  box-shadow:
    2px 2px 0 0 #0004, 8px 8px 0 0 #8882;
  max-width: 430px;
  width: 100%;
}
.w95-title-bar {
  background: linear-gradient(to right, #000080 80%, #1084d0 100%);
  color: #fff;
  font-weight: bold;
  font-size: 1.13rem;
  letter-spacing: .04em;
  padding: 7px 11px 5px 11px;
  display: flex;
  align-items: center;
  border-bottom: 2px solid var(--w95-border-dark);
  user-select: none;
}
.w95-title-bar .icon {
  width: 20px; height: 20px; margin-right: 8px;
  background: url('https://raw.githubusercontent.com/h01000110/windows-95/master/assets/app.png') no-repeat center center/contain;
  display: inline-block;
}
.w95-content {
  padding: 24px 18px 18px 18px;
}
.form-group {
  margin-bottom: 15px;
}
label {
  font-size: 0.98rem;
  color: var(--w95-label);
  margin-bottom: 2px;
  font-weight: 500;
  letter-spacing: .01em;
}
input[type="text"], input[type="password"] {
  background: var(--w95-input);
  border: 2px solid var(--w95-input-border);
  border-top-color: var(--w95-border-light);
  border-left-color: var(--w95-border-light);
  border-bottom-color: var(--w95-border-dark);
  border-right-color: var(--w95-border-dark);
  font-family: inherit;
  padding: 6px 6px;
  font-size: 1rem;
  outline: none;
  box-sizing: border-box;
  width: 100%;
}
input[type="text"]:focus, input[type="password"]:focus {
  background: #e7f0ff;
}
.inline-label {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-bottom: 7px;
  margin-top: -5px;
  font-size: 1rem;
  color: #000;
}
input[type="checkbox"] {
  accent-color: #000080;
  width: 16px; height: 16px;
}
.w95-btn {
  background: var(--w95-btn-bg);
  color: #111;
  font-family: inherit;
  font-size: 1.07rem;
  padding: 7px 0;
  width: 100%;
  border: 2px solid var(--w95-btn-border);
  border-top-color: var(--w95-btn-border-light);
  border-left-color: var(--w95-btn-border-light);
  border-bottom-color: var(--w95-btn-border-dark);
  border-right-color: var(--w95-btn-border-dark);
  margin-top: 13px;
  box-shadow: 1px 1.5px #fff8 inset;
  cursor: pointer;
  text-align: center;
  transition: background 0.13s;
  outline: none;
}
.w95-btn:active {
  border-top-color: var(--w95-btn-border-dark);
  border-left-color: var(--w95-btn-border-dark);
  border-bottom-color: var(--w95-btn-border-light);
  border-right-color: var(--w95-btn-border-light);
  background: #b7b7b7;
}
.w95-btn:disabled {
  color: #888;
  background: #e0e0e0;
  cursor: not-allowed;
}
#output {
  min-height: 18px;
  font-weight: bold;
  font-size: 1.07rem;
  margin-top: 18px;
  color: #000;
  background: #f6f6f6;
  border: 2px solid var(--w95-input-border);
  border-top-color: var(--w95-border-light);
  border-left-color: var(--w95-border-light);
  border-bottom-color: var(--w95-border-dark);
  border-right-color: var(--w95-border-dark);
  border-radius: 0;
  padding: 8px 6px;
  word-break: break-all;
  text-align: center;
  box-sizing: border-box;
}
#copyBtn {
  display: none;
  margin-top: 10px;
}
.w95-footer {
  text-align: right;
  color: #222;
  font-size: 0.93rem;
  opacity: .6;
  margin-top: 18px;
}

@media (max-width: 540px) {
  .w95-window { max-width: 100vw; margin: 0; box-shadow: none; border-radius: 0; }
  .w95-content { padding: 16px 4vw 14px 4vw; }
  .w95-title-bar { font-size: 1rem; padding: 8px 8px 6px 8px; }
}
</style>
</head>
<body>
<div class="w95-window">
  <div class="w95-title-bar">
    <span class="icon"></span>
    Secure Text Encoder
  </div>
  <div class="w95-content">
    <div class="form-group">
      <label for="textInput">Text to encode</label>
      <input type="text" id="textInput" placeholder="Enter text">
    </div>
    <div class="form-group">
      <label for="passInput">Passcode</label>
      <input type="password" id="passInput" placeholder="Enter passcode">
    </div>
    <label class="inline-label" title="Omit symbols from output">
      <input type="checkbox" id="noSymbols">
      No symbols (A-Z, a-z, 0-9 only)
    </label>
    <button class="w95-btn" onclick="encode()">Encode</button>
    <div id="output"></div>
    <button class="w95-btn" id="copyBtn" onclick="copyOutput()">Copy to Clipboard</button>
    <div class="w95-footer">v1.0</div>
  </div>
</div>

<script>
// --- All your original JS code here ---
const UPPER = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const LOWER = "abcdefghijklmnopqrstuvwxyz";
const NUMS  = "0123456789";
const SYMS  = "!@#$%^&*()-_=+[]{};:,.<>?";
const SYMBOLS_ALL = UPPER + LOWER + NUMS + SYMS;
const SYMBOLS_NOSYM = UPPER + LOWER + NUMS;

const OUTPUT_LEN = 16;
const PBKDF2_ITERATIONS = 750000;

function normalizeInput(str) {
    return str.toLowerCase().replace(/[\s']/g, "");
}

async function encode() {
    const text = normalizeInput(document.getElementById("textInput").value);
    const pass = normalizeInput(document.getElementById("passInput").value);
    const noSymbols = document.getElementById("noSymbols").checked;
    const outputEl = document.getElementById("output");
    const copyBtn = document.getElementById("copyBtn");

    if (!text || !pass) {
        outputEl.textContent = "Enter both text and passcode.";
        copyBtn.style.display = "none";
        return;
    }

    outputEl.textContent = "Encoding... please wait (~1 sec)";
    copyBtn.style.display = "none";

    const ALPHABET = noSymbols ? SYMBOLS_NOSYM : SYMBOLS_ALL;
    const combined = text + "::" + pass + (noSymbols ? "::nosym" : "::sym");

    const dynamicSalt = new TextEncoder().encode("FixedSaltPrefix::" + text);

    const baseKey = await crypto.subtle.importKey(
        "raw",
        new TextEncoder().encode(combined),
        { name: "PBKDF2" },
        false,
        ["deriveBits"]
    );

    const derivedBits = await crypto.subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: "SHA-256",
            salt: dynamicSalt,
            iterations: PBKDF2_ITERATIONS
        },
        baseKey,
        256
    );

    const hashArray = Array.from(new Uint8Array(derivedBits));
    let outputStr = hashArray.map(b => ALPHABET[b % ALPHABET.length]).join("").slice(0, OUTPUT_LEN);

    if (!meetsRequirements(outputStr, noSymbols)) {
        outputStr = forceRequirements(outputStr, noSymbols);
    }

    outputEl.textContent = outputStr;
    copyBtn.style.display = "inline-block";
}

function meetsRequirements(str, noSymbols) {
    const hasUpper = [...str].some(ch => UPPER.includes(ch));
    const hasLower = [...str].some(ch => LOWER.includes(ch));
    const hasNum   = [...str].some(ch => NUMS.includes(ch));
    const hasSym   = noSymbols ? true : [...str].some(ch => SYMS.includes(ch));
    return hasUpper && hasLower && hasNum && hasSym;
}

function forceRequirements(str, noSymbols) {
    return str.slice(0, OUTPUT_LEN - 4) + (noSymbols ? "Ab1a" : "Ab1@");
}

function copyOutput() {
    const outputStr = document.getElementById("output").textContent;
    if (!outputStr) return;

    navigator.clipboard.writeText(outputStr).then(() => {
        const copyBtn = document.getElementById("copyBtn");
        const oldText = copyBtn.textContent;
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = oldText, 1000);
    });
}
</script>
</body>
</html>
