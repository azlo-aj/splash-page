<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text Encoder</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000080">
<style>
/* Windows 95 styling (same as your provided design) */
:root {
  --w95-bg: #c0c0c0;
  --w95-window: #fff;
  --w95-border-light: #fff;
  --w95-border-dark: #808080;
  --w95-btn-bg: #e0e0e0;
  --w95-btn-border: #808080;
  --w95-btn-border-light: #fff;
  --w95-btn-border-dark: #000;
  --w95-label: #000;
  --w95-input: #fff;
}
body {
  background: var(--w95-bg);
  min-height: 100vh;
  margin: 0;
  font-family: 'MS Sans Serif', 'Tahoma', sans-serif;
  display: flex;
  align-items: flex-start;
  justify-content: center;
}
.w95-window {
  margin: 42px 0;
  background: var(--w95-window);
  border: 2px solid var(--w95-border-dark);
  box-shadow: 2px 2px 0 0 #0004, 8px 8px 0 0 #8882;
  max-width: 430px;
  width: 100%;
}
.w95-title-bar {
  background: linear-gradient(to right, #000080 80%, #1084d0 100%);
  color: #fff;
  font-weight: bold;
  font-size: 1.13rem;
  padding: 7px 11px;
  display: flex;
  align-items: center;
  border-bottom: 2px solid var(--w95-border-dark);
}
.w95-content {
  padding: 24px 18px 18px;
}
label {
  font-size: 0.98rem;
  margin-bottom: 2px;
  display: block;
}
input[type="text"], input[type="password"] {
  background: var(--w95-input);
  border: 2px solid var(--w95-border-dark);
  padding: 6px;
  font-size: 1rem;
  box-sizing: border-box;
  width: 100%;
}
.inline-label {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-top: 8px;
}
input[type="checkbox"] {
  accent-color: #000080;
  width: 16px; height: 16px;
}
.w95-btn {
  background: var(--w95-btn-bg);
  font-size: 1.07rem;
  padding: 7px 0;
  width: 100%;
  border: 2px solid var(--w95-btn-border);
  border-top-color: var(--w95-btn-border-light);
  border-left-color: var(--w95-btn-border-light);
  border-bottom-color: var(--w95-btn-border-dark);
  border-right-color: var(--w95-btn-border-dark);
  margin-top: 13px;
  cursor: pointer;
}
#output {
  min-height: 18px;
  font-weight: bold;
  font-size: 1.07rem;
  margin-top: 18px;
  background: #f6f6f6;
  border: 2px solid var(--w95-border-dark);
  padding: 8px 6px;
  text-align: center;
  box-sizing: border-box;
}
#copyBtn {
  display: none;
  margin-top: 10px;
}
</style>
</head>
<body>
<div class="w95-window">
  <div class="w95-title-bar">Secure Text Encoder</div>
  <div class="w95-content">
    <label for="textInput">Text to encode</label>
    <input type="text" id="textInput" placeholder="Enter text">

    <label for="passInput">Passcode</label>
    <input type="password" id="passInput" placeholder="Enter passcode">

    <label class="inline-label">
      <input type="checkbox" id="noSymbols">
      No symbols (A-Z, a-z, 0-9 only)
    </label>

    <button class="w95-btn" onclick="encode()">Encode</button>
    <div id="output"></div>
    <button class="w95-btn" id="copyBtn" onclick="copyOutput()">Copy to Clipboard</button>
  </div>
</div>

<script>
const UPPER = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const LOWER = "abcdefghijklmnopqrstuvwxyz";
const NUMS  = "0123456789";
const SYMS  = "!@#$%^&*()-_=+[]{};:,.<>?";
const SYMBOLS_ALL = UPPER + LOWER + NUMS + SYMS;
const SYMBOLS_NOSYM = UPPER + LOWER + NUMS;
const OUTPUT_LEN = 16;
const PBKDF2_ITERATIONS = 750000;

function normalizeInput(str) {
    return str.toLowerCase().replace(/[\s']/g, "");
}

async function encode() {
    const text = normalizeInput(document.getElementById("textInput").value);
    const pass = normalizeInput(document.getElementById("passInput").value);
    const noSymbols = document.getElementById("noSymbols").checked;
    const outputEl = document.getElementById("output");
    const copyBtn = document.getElementById("copyBtn");

    if (!text || !pass) {
        outputEl.textContent = "Enter both text and passcode.";
        copyBtn.style.display = "none";
        return;
    }

    outputEl.textContent = "Encoding... please wait (~1 sec)";
    copyBtn.style.display = "none";

    const ALPHABET = noSymbols ? SYMBOLS_NOSYM : SYMBOLS_ALL;
    const combined = text + "::" + pass + (noSymbols ? "::nosym" : "::sym");
    const dynamicSalt = new TextEncoder().encode("FixedSaltPrefix::" + text);

    const baseKey = await crypto.subtle.importKey(
        "raw",
        new TextEncoder().encode(combined),
        { name: "PBKDF2" },
        false,
        ["deriveBits"]
    );

    const derivedBits = await crypto.subtle.deriveBits(
        { name: "PBKDF2", hash: "SHA-256", salt: dynamicSalt, iterations: PBKDF2_ITERATIONS },
        baseKey,
        256
    );

    const hashArray = Array.from(new Uint8Array(derivedBits));
    let outputStr = hashArray.map(b => ALPHABET[b % ALPHABET.length]).join("").slice(0, OUTPUT_LEN);

    if (!meetsRequirements(outputStr, noSymbols)) {
        outputStr = forceRequirements(outputStr, noSymbols);
    }

    outputEl.textContent = outputStr;
    copyBtn.style.display = "inline-block";
}

function meetsRequirements(str, noSymbols) {
    return (
        [...str].some(ch => UPPER.includes(ch)) &&
        [...str].some(ch => LOWER.includes(ch)) &&
        [...str].some(ch => NUMS.includes(ch)) &&
        (noSymbols ? true : [...str].some(ch => SYMS.includes(ch)))
    );
}

function forceRequirements(str, noSymbols) {
    return str.slice(0, OUTPUT_LEN - 4) + (noSymbols ? "Ab1a" : "Ab1@");
}

function copyOutput() {
    const outputStr = document.getElementById("output").textContent;
    if (!outputStr) return;
    navigator.clipboard.writeText(outputStr).then(() => {
        const copyBtn = document.getElementById("copyBtn");
        const oldText = copyBtn.textContent;
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = oldText, 1000);
    });
}

if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
